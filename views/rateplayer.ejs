<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/stylesheets/rating.css">
</head>

<body>
    <div class="cardP">
        <img src="/images/uploads/playerDP/<%=pdata.image%>" alt="" srcset="">
        <h1P><%=pdata.name%></h1P>
        <%if (userData && pdata.users.includes(userData.id) ){ %> 
                <h1P>You just rated</h1P>
        <%} else {%>
            <ul id="ph">
                <li class="heart"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        height="80px" width="80px" version="1.1" id="Capa_1" viewBox="0 0 50 50" xml:space="preserve"
                        style="fill:#1a1a1a;">
                        <path
                            d="M24.85,10.126c2.018-4.783,6.628-8.125,11.99-8.125c7.223,0,12.425,6.179,13.079,13.543  c0,0,0.353,1.828-0.424,5.119c-1.058,4.482-3.545,8.464-6.898,11.503L24.85,48L7.402,32.165c-3.353-3.038-5.84-7.021-6.898-11.503  c-0.777-3.291-0.424-5.119-0.424-5.119C0.734,8.179,5.936,2,13.159,2C18.522,2,22.832,5.343,24.85,10.126z" />
                        <path style="fill:#ffffff;"
                            d="M6,18.078c-0.553,0-1-0.447-1-1c0-5.514,4.486-10,10-10c0.553,0,1,0.447,1,1s-0.447,1-1,1  c-4.411,0-8,3.589-8,8C7,17.631,6.553,18.078,6,18.078z" />
                    </svg></li>
                <li class="heart"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        height="80px" width="80px" version="1.1" id="Capa_1" viewBox="0 0 50 50" xml:space="preserve"
                        style="fill:#1a1a1a;">
                        <path
                            d="M24.85,10.126c2.018-4.783,6.628-8.125,11.99-8.125c7.223,0,12.425,6.179,13.079,13.543  c0,0,0.353,1.828-0.424,5.119c-1.058,4.482-3.545,8.464-6.898,11.503L24.85,48L7.402,32.165c-3.353-3.038-5.84-7.021-6.898-11.503  c-0.777-3.291-0.424-5.119-0.424-5.119C0.734,8.179,5.936,2,13.159,2C18.522,2,22.832,5.343,24.85,10.126z" />
                        <path style="fill:#ffffff;"
                            d="M6,18.078c-0.553,0-1-0.447-1-1c0-5.514,4.486-10,10-10c0.553,0,1,0.447,1,1s-0.447,1-1,1  c-4.411,0-8,3.589-8,8C7,17.631,6.553,18.078,6,18.078z" />
                    </svg></li>
                <li class="heart"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        height="80px" width="80px" version="1.1" id="Capa_1" viewBox="0 0 50 50" xml:space="preserve"
                        style="fill:#1a1a1a;">
                        <path
                            d="M24.85,10.126c2.018-4.783,6.628-8.125,11.99-8.125c7.223,0,12.425,6.179,13.079,13.543  c0,0,0.353,1.828-0.424,5.119c-1.058,4.482-3.545,8.464-6.898,11.503L24.85,48L7.402,32.165c-3.353-3.038-5.84-7.021-6.898-11.503  c-0.777-3.291-0.424-5.119-0.424-5.119C0.734,8.179,5.936,2,13.159,2C18.522,2,22.832,5.343,24.85,10.126z" />
                        <path style="fill:#ffffff;"
                            d="M6,18.078c-0.553,0-1-0.447-1-1c0-5.514,4.486-10,10-10c0.553,0,1,0.447,1,1s-0.447,1-1,1  c-4.411,0-8,3.589-8,8C7,17.631,6.553,18.078,6,18.078z" />
                    </svg></li>
                <li class="heart"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        height="80px" width="80px" version="1.1" id="Capa_1" viewBox="0 0 50 50" xml:space="preserve"
                        style="fill:#1a1a1a;">
                        <path
                            d="M24.85,10.126c2.018-4.783,6.628-8.125,11.99-8.125c7.223,0,12.425,6.179,13.079,13.543  c0,0,0.353,1.828-0.424,5.119c-1.058,4.482-3.545,8.464-6.898,11.503L24.85,48L7.402,32.165c-3.353-3.038-5.84-7.021-6.898-11.503  c-0.777-3.291-0.424-5.119-0.424-5.119C0.734,8.179,5.936,2,13.159,2C18.522,2,22.832,5.343,24.85,10.126z" />
                        <path style="fill:#ffffff;"
                            d="M6,18.078c-0.553,0-1-0.447-1-1c0-5.514,4.486-10,10-10c0.553,0,1,0.447,1,1s-0.447,1-1,1  c-4.411,0-8,3.589-8,8C7,17.631,6.553,18.078,6,18.078z" />
                    </svg></li>
                <li class="heart"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        height="80px" width="80px" version="1.1" id="Capa_1" viewBox="0 0 50 50" xml:space="preserve"
                        style="fill:#1a1a1a;">
                        <path
                            d="M24.85,10.126c2.018-4.783,6.628-8.125,11.99-8.125c7.223,0,12.425,6.179,13.079,13.543  c0,0,0.353,1.828-0.424,5.119c-1.058,4.482-3.545,8.464-6.898,11.503L24.85,48L7.402,32.165c-3.353-3.038-5.84-7.021-6.898-11.503  c-0.777-3.291-0.424-5.119-0.424-5.119C0.734,8.179,5.936,2,13.159,2C18.522,2,22.832,5.343,24.85,10.126z" />
                        <path style="fill:#ffffff;"
                            d="M6,18.078c-0.553,0-1-0.447-1-1c0-5.514,4.486-10,10-10c0.553,0,1,0.447,1,1s-0.447,1-1,1  c-4.411,0-8,3.589-8,8C7,17.631,6.553,18.078,6,18.078z" />
                    </svg></li>
    
            </ul>
       <% }%>
    </div>
    <div class="overlay"></div>
    <div class="fom">
        <form id="form" action="/submitRating" method="post">
            <label for="rating"></label>
            <select name="rating" id="rating" style="display: none;">
              <option value="1">1 Star</option>
              <option value="2">2 Stars</option>
              <option value="3">3 Stars</option>
              <option value="4">4 Stars</option>
              <option value="5">5 Stars</option>
            </select>
            <input type="hidden" name="heartValue" id="heartValue">
            <input type="text" name="userID" value="<%=userData._id%>" id="userID">
            <input type="text" name="playerId" value="<%=pdata._id%>" style="display:none;">
            <textarea rows="4" id="feedback" cols="50" name="feedback" placeholder="Write your thoughts  about <%=pdata.name%>"></textarea>
            <button id="btn" type="submit">Submit Rating</button>
        </form>
    </div>

    <div class="comments">
        <h1>Ratings <%=pdata.feedbackC.length %></h1>
    <%pdata.feedbackC.forEach(data =>{ %>
        <div class="cdiv">
            <div class="flex" style="display: flex;">
            <img src="/images/profiles/<%=data.user.dp%>" alt="profile pic of user">
        <h2><%=data.user.name %></h2>
    </div>
        
       <h3>Hearts: <%= data.heart%></h3>
       <p class="text"><%=data.comment %></p>
    </div>
   <% }) %>
    </div>


    <script>
        let heart = document.querySelectorAll(".heart");
        let overlay = document.querySelector(".overlay");
        let form = document.querySelector(".fom");
        let heartValue = document.querySelector("#heartValue");
        let select = document.querySelector("#rating");


        for (x = 0; x < heart.length; x++) {
            heart[x].heartV = (x + 1);
            ["click", "mouseover", "mouseout"].forEach(e => {
                heart[x].addEventListener(e, showHeart)
            })
        }

        function showHeart(e) {
            let tp = e.type;
            let heartV = this.heartV;
            if (tp === 'click') {
                overlay.style.display = "block";
                form.style.display = "block";
                heartValue.value = heartV;
            }

            heart.forEach(function (elem, ind) {
                if (tp === 'click') {
                    if (ind < heartV) {
                        select.value= heartV;
                        elem.classList.add("red");
                    } else {
                        elem.classList.remove("red");
                    }
                }
            });
        }
    </script>
</body>

</html>
